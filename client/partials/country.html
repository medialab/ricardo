<div class="container">

  <div ng-show="missing" class="alert"> 
    <div class="modal-body" >
     <p>
        There is <strong>no data available</strong> in the database for {{entities.sourceEntity.selected.RICname}}
     </p>
     <p>
     between {{selectedMinDate}} and {{selectedMaxDate}}  
     </p>
      <p>
        Choose another one or change date selection, thank you !
     </p>
    </div>
    <div class="modal-footer">
        <button class="btn btn-default" ng-click="ok()">OK</button>
    </div>
  </div>
</div>

<div class="container">  
  </br>
  </br>
  <p class="paragraphPage">
      La vue pays montre comment le commerce total d’un reporting country se répartit entre ses différents partners. Elle compare les partner entities suivant leur part moyenne dans le commerce total du pays reporting, calcule le solde commercial bilateral annuel et permet de suivre l’évolution du commerce du pays reporting avec ses partners. 
    </p>
  <div class="row timeline-cont" >
    <div class="col-md-12">
        <country-title></country-title>
        <p class="paragraphViz">
            In this graph, total trade equals the sum of export (import) flows with all partner entities. 
          </p>
        <dual-timeline 
          ng-data="timelineData" 
          start-date="selectedMinDate" 
          end-date="selectedMaxDate" 
        ></dual-timeline>  
    </div>   
  </div>
</div>


<div class="container">
  <div class="row">
      <div id="countryBrushing" class="col-sm-12">
        <br>
        <br>
        <h4>Available and unavailable data for {{entities.sourceEntity.selected.RICname}}</h4>
        <brushing-timeline
          ng-data="timelineData"
          start-date="selectedMinDate"
          end-date="selectedMaxDate"
          raw-start-date="rawMinDate"
          raw-end-date="rawMaxDate"
          source-country="entities.sourceEntity.selected.RICname"
          target-country="entities.targetEntity.selected.RICname"
        ></brushing-timeline>
      <div class="legend">
        <div class="legend-item">
          <div class="square import"></div> Import
        </div>
        <div class="legend-item">
          <div class="square export"></div> Export
        </div>
        <div class="legend-item">
          <div class="line available"></div> Available data
        </div>
        <div class="legend-item">
          <div class="line unavailable"></div> Unavailable data
        </div>
        <div class="legend-item">
          Data expressed in <strong>Sterling</strong>
        </div>
      </div>
    </div>
         
  </div>
</div>

<div class="container">
  <br>
  <br>
  <h4> Trade of reporting with partners sorted by
  <div class="inline-select">   
      <ui-select ng-model="grouped" theme="bootstrap" ng-change="changeGroup(grouped)">
        <match placeholder="Group by...">{{$select.selected.name.value}}</match>
        <choices repeat="item in groups | filter: $select.search">
          <div ng-bind-html="item.name.value | highlight: $select.search"></div>
        </choices>
      </ui-select>
  </div>
    on
  <div class="inline-select">
      <ui-select ng-model="ordered" theme="bootstrap" ng-change="changeOrder(ordered)">
      <match placeholder="Order by...">{{$select.selected.name.value}}</match>
      <choices repeat="item in orders | filter: $select.search">
        <div ng-bind-html="item.name.value | highlight: $select.search"></div>
      </choices>
      </ui-select>
  </div>
    on
  <div class="inline-select">
    <ui-select ng-model="filtered" theme="bootstrap" ng-change="changeFilter(filtered)">
      <match placeholder="Filter by...">{{$select.selected.name.value}}</match>
      <choices repeat="item in filters | filter: $select.search">
        <div ng-bind-html="item.name.value | highlight: $select.search"></div>
      </choices>
    </ui-select>
  </div>
  by
  <div class="inline-select">
    <ui-select ng-model="sorted" theme="bootstrap" ng-change="changeSort(sorted)">
      <match placeholder="Sort by...">{{$select.selected.name.value}}</match>
      <choices repeat="item in sorts | filter: $select.search">
        <div ng-bind-html="item.name.value | highlight: $select.search"></div>
      </choices>
    </ui-select>
  </div>
   
  </h4>
  <div class="row">
    <div class="col-md-12">
      <p class="paragraphViz">
          In this graph, the partners of the reporting country are compared by calculating two indicators: 
          <ul>
            <li class="paragraphViz">
              the average bilateral trade share estimated for available years over the selected period
            </li>
            <li class="paragraphViz">
              the relative bilateral trade balance estimated for each available year over the selected period
            </li>
          </ul>
      </p>
          <div class="legend-item">
          A = reporting  /   B = partner
          </div>
          <div class="legend-item">
          Exp A -> B = exports from A to B
          </div>
          <div class="legend-item">
          ExpA = total exports of A
          </div> 
          </br>
          <div class="legend-item">
          Average bilateral trade share = Exp A->B / ExpA * 100
          </div>
          <div class="legend-item">
          Relative bilateral trade balance = (Exp A->B – Imp A->B) / (Exp A->B + Imp A->B)
          </div>
    </div>
  </div>


<div id="select-doubleChart">
  <div class="row">
    <div  class="col-sm-12">
      <div ng-show="missingPartner" class="alert"> 
        <div class="modal-body" >
         <p>
            There is <strong>no data available</strong> in the database for this filter
         </p>
         <p>
         between {{selectedMinDate}} and {{selectedMaxDate}}  
         </p>
          <p>
            Choose another one or change date selection, thank you !
         </p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-default" ng-click="okPartner()">OK</button>
        </div>
      </div>
      <partners-histogram 
      ng-data="partnersData" 
      start-date="selectedMinDate"
      end-date="selectedMaxDate"
      index-years="indexYears"
      country-data="entities.sourceEntity.selected"
      order-data="ordered.type.value"
      ></partners-histogram>
    </div>
  </div>
    <div class="partnersHistoLegend">
      <div class="legend-item">
        <svg height="35" width="300">
          <circle cx="25" cy="18" r="12" stroke="black" stroke-width="1" fill="transparent" />
          <circle cx="25" cy="18" r="3" stroke="black" stroke-width="1" fill="black" />
          <text x="45" y="20" fill="black">Average bilateral trade share</text>
        </svg> 
      </div> 
      <div class="legend-item">
        <svg height="35" width="300">
          <rect x="15" y="0" width="10" height="15" style="fill:#cc6666" />
          <rect x="25" y="15" width="10" height="15" style="fill:#663333" />
          <text x="40" y="20" fill="black">Relative bilateral trade balance</text>
        </svg> 
      </div>  
    </div>
</div>

  <div class="row">
    <div class="col-md-12">
      <br/>
      <br/>
      <h4 class="titleDualTL">Trade of {{entities.sourceEntity.selected.RICname}} with 
      <span ng-repeat="elm in reporting" ng-click="removeReporting(elm)" ng-style="{color:elm.color}" >{{elm.RICname}}
      
      <span class="close-btn">
       <i class="fa fa-times-circle"></i>
      </span>
      <span ng-if="!$last">, </span>
      </span>, 
      <br/>
      {{selectedMinDate}} – {{selectedMaxDate}}, in   
      <div class="inline-select">
        <ui-select ng-model="linechartCurrency" theme="bootstrap" ng-change="changeCurrency(linechartCurrency)">
          <match placeholder="Select sterling or percent">{{$select.selected.name.value}}</match>
          <choices repeat="item in linechartCurrencyChoices | filter: $select.search">
            <div ng-bind-html="item.name.value | highlight: $select.search"></div>
          </choices>
        </ui-select>
    </div> 
    for
    <div class="inline-select">
      <ui-select ng-model="linechartFlow" theme="bootstrap" ng-change="changeFlow(linechartFlow)">
        <match placeholder="Select type flow">{{$select.selected.name.value}}</match>
        <choices repeat="item in linechartFlowChoices | filter: $select.search">
          <div ng-bind-html="item.name.value | highlight: $select.search"></div>
        </choices>
      </ui-select>
    </div>
      </h4>
        <div ng-show="messagePercent"> 
         <p>
            The percentages are based on the total amount of <a href="/#worldTrade">world sum partners</a> of {{entities.sourceEntity.selected.RICname}}
         </p>
        </div>
    </div>
  </div>
  <div id="select-lineChart">
    <div>
      <h4 class="subtitle col-md-2" style="width:190px;">select up to 5 partners:</h4>
    </div>
  <div class="col-md-9"  style="padding-top:10px;">
    
    <div class="inline-select" >
      <ui-select   ng-model="entities.sourceCountryEntity.selected" theme="bootstrap"  ng-change="changeCountry(entities.sourceCountryEntity.selected)">
        <match placeholder="Country"></match>
        <choices repeat="item in reportingCountryEntities | filter: $select.search">
          <div ng-bind-html="item.RICname | highlight: $select.search"></div>
        </choices>
      </ui-select>
    </div>

    <div class="inline-select">
      <ui-select  ng-model="entities.sourceColonialEntity.selected" theme="bootstrap"  ng-change="changeColonial(entities.sourceColonialEntity.selected)">
        <match placeholder="Colonial area"></match>
        <choices repeat="item in reportingColonialEntities | filter: $select.search">
          <div ng-bind-html="item.RICname | highlight: $select.search"></div>
        </choices>
      </ui-select>
    </div>

    <div class="inline-select">
      <ui-select  ng-model="entities.sourceGeoEntity.selected" theme="bootstrap" ng-show="reportingGeoEntities.length" ng-change="changeGeo(entities.sourceGeoEntity.selected)">
        <match placeholder="Geographical area"></match>
        <choices repeat="item in reportingGeoEntities | filter: $select.search">
          <div ng-bind-html="item.RICname | highlight: $select.search"></div>
        </choices>
      </ui-select>
    </div>

    <div class="inline-select">
      <ui-select  ng-model="entities.sourceContinentEntity.selected" theme="bootstrap" ng-show="reportingContinentEntities.length" ng-change="changeContinent(entities.sourceContinentEntity.selected)">
        <match placeholder="Continent"></match>
        <choices repeat="item in reportingContinentEntities | filter: $select.search">
          <div ng-bind-html="item.RICname | highlight: $select.search"></div>
        </choices>
      </ui-select>
    </div>

    <div class="inline-select">
      <ui-select  ng-model="entities.sourceWorldEntity.selected" theme="bootstrap" ng-show="reportingWorldEntities.length" ng-change="changeWorld(entities.sourceWorldEntity.selected)">
        <match placeholder="World trade"></match>
        <choices repeat="item in reportingWorldEntities | filter: $select.search">
          <div ng-bind-html="item.RICname | highlight: $select.search"></div>
        </choices>
      </ui-select>
    </div>

  </div>
    
  <div class="row">
    <div class="col-sm-12">
      <linechart-world ng-data="linechartData">
      </linechart-world>
    </div>
  </div>
</div>
  <div class="row">
    <div class="col-sm-12 text-center shdt">
      <button type="button" class="btn" ng-model="viewTable" btn-checkbox btn-checkbox-true="1" btn-checkbox-false="0">
          Show/Hide data table
      </button>
      <button type="button" ng-click="download()" class="btn">
          Download data
      </button>
      <button type="button" ng-click="downloadCurrency()" class="btn">
          Download data with original currency
      </button>
    </div>
  </div>
  <div ng-if="viewTable" class="row table-cont">
    <div class="col-sm-12 grid-cont">
      <div class="gridStyle" ng-grid="gridOptions" >
        <div class="grid-overlay-msg" ng-show="loading">
          <div class="msg">
            <span>Loading Data...
            <i class="fa fa-spinner fa-spin"></i></span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>